.\" XLOCALE(3) Manual Page
.TH XLOCALE 3 "2025" "Extern Library" "Programmer's Manual"
.SH NAME
xlocale \- portable UTF\-8 aware locale initialization utilities
.SH SYNOPSIS
.nf
#include <xlocale.h>

char*      xsetlocale(int category, const char *req_locale);
wchar_t*   wsetlocale(int category, const wchar_t *req_locale);
wchar_t*   xwsetlocale(int category, const wchar_t *req_locale);

xlocale_t  xnewlocale(int category_mask, const char *req_locale,
                      xlocale_t base);
void       xfreelocale(xlocale_t loc);

void       xinit_console_utf8(void);
void       xinit_console_wutf(void);

typedef locale_t  (POSIX)
typedef _locale_t (Windows)
.fi
.SH DESCRIPTION
The xlocale library provides an operating\-system independent interface for
initializing locales with automatic UTF\-8 fallback handling.

It wraps the standard C library functions setlocale(3), wsetlocale(3),
newlocale(3), freelocale(3), and their Windows equivalents.

The library attempts to set a user specified locale first. If this fails,
a sequence of UTF\-8 compatible aliases is attempted, followed by the system
default locale, and finally the POSIX "C" locale.

.SH FUNCTIONS
.SS xsetlocale()
Attempts to set a narrow\-string locale. The following order is used:

.RS
.IP \(bu 2
Requested locale
.IP \(bu
UTF\-8 aliases ("C.UTF-8", "en_US.UTF-8", "UTF-8", ".UTF8", ".utf8", ".65001")
.IP \(bu
System default locale ("")
.IP \(bu
Fallback "C"
.RE

Returns the locale string or NULL on total failure.

.SS wsetlocale()
Wide\-string equivalent of setlocale(). On POSIX, performs conversions using
xwcstombs() and xmbstowcs(). On Windows, wraps _wsetlocale().

.SS xwsetlocale()
Pure wide\-string locale setter, using the same UTF\-8 fallback strategy.

.SS xnewlocale()
Creates a new locale object:

.TP
Windows:
_wraps _create_locale()

.TP
POSIX:
wraps newlocale()

Same fallback strategy as xsetlocale().

Returns a new xlocale_t or NULL.

.SS xfreelocale()
Destroys a locale object created by xnewlocale().

.SS xinit_console_utf8()
Windows\-only routine enabling UTF\-8 console output.
Sets codepages and switches stdout to _O_U8TEXT.

Calls xsetlocale() with a UTF\-8 locale.

.SS xinit_console_wutf()
Like xinit_console_utf8(), but uses wide UTF\-16 console modes.

.SH RETURN VALUES
Most functions return a locale string, wide string, or locale object.

Failure results in NULL.

.SH ERRORS
On POSIX, errors may be generated by newlocale() or memory conversion
routines.

Windows errors may occur if the requested codepage is unsupported.

.SH THREAD SAFETY
setlocale() is not guaranteed to be thread\-safe.
The xlocale library does not provide internal locking.

Callers must ensure external synchronization.

.SH EXAMPLES
.nf
xsetlocale(XLC_ALL, "C.UTF-8");

xlocale_t loc = xnewlocale(XLC_ALL_MASK, "en_US.UTF-8", NULL);
xfreelocale(loc);
.fi

.SH SEE ALSO
setlocale(3), newlocale(3), freelocale(3), wcsdup(3)

.SH AUTHOR
Written by MrR736.

.SH COPYRIGHT
GPLv3 or later.
